this.createSliders=function(){$(".gt-slider").each(function(){function i(){d&&r.find(".gt-slider-arrow-holder").html(""),l=r.outerWidth()/s,r.find(".gt-slider-container").outerWidth((h+1)*l),g.each(function(){$(this).outerWidth(l)}),h>s&&(d&&function(){var i="";f&&(i='<div class="gt-slider-arrow-num"><i class="gt-slider-num-curr">1</i> <i>из</i> <i class="gt-slider-num-max">10</i> </div>');r.find(".gt-slider-arrow-holder").html('<span class = "gt-slider-arrow left"><i class="fa fa-angle-left fa-2x"></i></span>'+i+'<span class = "gt-slider-arrow right"><i class="fa fa-angle-right fa-2x"></i></span>'),r.find(".left").off().on("click",function(){e(!1)}),r.find(".right").off().on("click",function(){e(!0)}),n(),f&&t()}(),c&&function(){for(var i=r.find(".gt-slider-nav"),n="",t=0;t<h;t++)n+="<span data-num = "+t+"></span>";i.html(n),i.find("span").first().addClass("gt-active"),r.find(".gt-slider-nav span").off().on("click",function(){e(!0,+$(this).attr("data-num"))})}()),o=r.outerHeight(),r.find(".gt-img-holder").outerHeight(o)}function n(){var i=r.find(".left"),n=r.find(".right");n.removeClass("not-active"),i.removeClass("not-active"),0==a&&i.addClass("not-active"),a!=h-1&&a!=h-s||n.addClass("not-active")}function e(i,e){return e||0===e?a=e:i?a+=1:a-=1,a>h-s?(a=h-s,void self.sliderEndLeft(r)):a<0?(a=0,void self.sliderEndRight(r)):(self.sliderMove(r,l,a),d&&n(),void(f&&t()))}function t(){r.find(".gt-slider-num-curr").text(a+1),r.find(".gt-slider-num-max").text(h)}var s,l,o,r=$(this),a=0,d=!1,c=!1,f=!1,g=r.find(".gt-slider-inner"),h=g.length;r.hasClass("gt-slider-has-arrow")&&(d=!0,r.hasClass("gt-slider-num")&&(f=!0),r.append('<div class="gt-slider-arrow-holder"></div>')),r.hasClass("gt-slider-has-dots")&&(c=!0,r.append('<div class="gt-slider-nav"></div>')),findScreenConst(),i(),function(){var i=0,n=0;r.on("touchstart",function(n){var e=n.originalEvent;i=Math.abs(e.touches[0].pageX)}),r.on("touchend",function(t){var s=t.originalEvent;n=Math.abs(s.changedTouches[0].pageX),Math.abs(i-n)>50&&e(!(i>n))})}(),r.find(".gt-slider-open-clone")&&r.find(".gt-slider-open-clone").each(function(){$(this).on("click",function(){self.createCloneSlider(r,$(this).parent().index())})}),$(window).resize(function(){findScreenConst(),i(),a>h-s&&(a=h-s),h<=s&&(a=0),self.sliderMove(r,l,a)})})},this.createCloneSlider=function(i,n){function e(){if((l+=1)>c-1)return l=c-1,void self.sliderEndRight(o);self.sliderMove(o,f,l),s()}function t(){if((l-=1)<0)return l=0,void self.sliderEndLeft(o);self.sliderMove(o,f,l),s()}function s(){if($("#gt-clone-arrow-left")){var i=$("#gt-clone-arrow-left"),n=$("#gt-clone-arrow-right");n.removeClass("not-active"),i.removeClass("not-active"),0==l&&i.addClass("not-active"),l==c-1&&n.addClass("not-active")}}if(!$("div").is("#gt-clone")){self.fixBody();var l=n;$("#gt-body-wrapper").show().append('<div id = "gt-clone" class="gt-slider-clone"><div id = "gt-clone-close" class = "gt-slider-clone-close"></div><div class="container"><div id = "gt-clone-inner" class = "gt-slider-clone-inner"><div id = "gt-clone-container" class = "gt-slider-container gt-slider-clone-container"></div></div></div></div>');var o=$("#gt-clone-inner"),r=i.find(".gt-slider-inner").clone(!0),a=r.length;r.each(function(){$(this).removeClass("gt-slider-inner").addClass("gt-clone-slider-inner"),$(this).find(".gt-slider-inner-cover").remove(),$("#gt-clone-container").append($(this))}),a>1&&($("#gt-clone .container").append('<span class = "gt-slider-arrow left" id = "gt-clone-arrow-left"><i class="fa fa-angle-left fa-2x"></i></span><span class = "gt-slider-arrow right" id = "gt-clone-arrow-right"><i class="fa fa-angle-right fa-2x"></i></span>'),$("#gt-clone-arrow-left").on("click",t),$("#gt-clone-arrow-right").on("click",e));var d=o.find("#gt-clone-container"),c=r.length,f=o.outerWidth();r.each(function(){$(this).outerWidth(f)}),d.outerWidth(f*(c+1)),d.css("margin-left",-1*f*l+"px"),setTimeout(function(){d.addClass("gt-animated")}),s();var g=0,h=0;o.on("touchstart",function(i){var n=i.originalEvent;g=Math.abs(n.touches[0].pageX)}),o.on("touchend",function(i){var n=i.originalEvent;h=Math.abs(n.changedTouches[0].pageX),Math.abs(g-h)>50&&(g>h?t():e())}),$("#gt-clone-close").on("click",function(){self.destroyCloneSlider()})}},this.destroyCloneSlider=function(){$("#gt-clone-arrow-right").off(),$("#gt-clone-arrow-left").off(),$("#gt-clone-close").off(),$("#gt-clone-inner").off(),$("#gt-clone").remove(),$("#gt-body-wrapper").hide(),self.unfixBody()},this.sliderEndLeft=function(i){console.log("left_end")},this.sliderEndRight=function(i){console.log("right_end")},this.sliderMove=function(i,n,e){if(i.find(".gt-slider-nav")){var t=i.find(".gt-slider-nav span");t.removeClass("gt-active"),$(t[e]).addClass("gt-active")}i.find(".gt-slider-container").css("margin-left",-1*n*e+"px")},this.numberCollectionArticle=function(i){i.find(".gt-collection-link-wrapper").each(function(){$(this).find(".gt-collection-link-slider-wrapper").after('<div class = "gt-collection-link-number"><span>'+($(this).index()+1)+"</span></div>")})},$("div").is(".gt-collection-wrapper-num")&&$(".gt-collection-wrapper-num").each(function(){self.numberCollectionArticle($(this))}),$("div").is(".gt-slider")&&self.createSliders();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIl9zbGlkZXJfX19fX19fX19fX18uanMiXSwibmFtZXMiOlsidGhpcyIsImNyZWF0ZVNsaWRlcnMiLCIkIiwiZWFjaCIsInNldEJhc2VXaWR0aCIsImFycm93IiwiY3VyclNsaWRlciIsImZpbmQiLCJodG1sIiwiYmFzZVdpZHRoIiwib3V0ZXJXaWR0aCIsInNjcmVlbkNvbnN0IiwiaW5uZXJDb3VudCIsImlubmVyIiwibnVtSW5uZXIiLCJudW1QYW5lbCIsIm9mZiIsIm9uIiwib25lTW92ZUZ1bmN0aW9uIiwiY2hlY2tQb3NpdGlvbiIsInNob3dOdW0iLCJjcmVhdGVBcnJvd3MiLCJkb3RzIiwibmF2Iiwic3BhbnMiLCJpIiwiZmlyc3QiLCJhZGRDbGFzcyIsImF0dHIiLCJjcmVhdGVEb3RzIiwiYmFzZUhlaWdodCIsIm91dGVySGVpZ2h0IiwibGVmdCIsInJpZ2h0IiwicmVtb3ZlQ2xhc3MiLCJjdXJyUG9zaXRpb24iLCJidWwiLCJudW0iLCJzZWxmIiwic2xpZGVyRW5kTGVmdCIsInNsaWRlckVuZFJpZ2h0Iiwic2xpZGVyTW92ZSIsInRleHQiLCJsZW5ndGgiLCJoYXNDbGFzcyIsImFwcGVuZCIsImZpbmRTY3JlZW5Db25zdCIsImluaXRpYWxQb2ludCIsImZpbmFsUG9pbnQiLCJldmVudCIsImUiLCJvcmlnaW5hbEV2ZW50IiwiTWF0aCIsImFicyIsInRvdWNoZXMiLCJwYWdlWCIsImNoYW5nZWRUb3VjaGVzIiwiY3JlYXRlVG91Y2giLCJjcmVhdGVDbG9uZVNsaWRlciIsInBhcmVudCIsImluZGV4Iiwid2luZG93IiwicmVzaXplIiwiZWwiLCJtb3ZlQ2xvbmVTbGlkZXJSaWdodCIsImlubmVyTGVuZ3RoIiwibW92ZUNsb25lU2xpZGVyTGVmdCIsImlzIiwiZml4Qm9keSIsInNob3ciLCJpbm5lcnMiLCJjbG9uZSIsImlubmVyc0xlbmdodCIsInJlbW92ZSIsImNvbnRhaW5lciIsImNzcyIsInNldFRpbWVvdXQiLCJkZXN0cm95Q2xvbmVTbGlkZXIiLCJoaWRlIiwidW5maXhCb2R5IiwiY29uc29sZSIsImxvZyIsIndpZHRoIiwicG9zaXRpb24iLCJudW1iZXJDb2xsZWN0aW9uQXJ0aWNsZSIsImFmdGVyIl0sIm1hcHBpbmdzIjoiQUFPQUEsS0FBS0MsY0FBZ0IsV0FDREMsRUFBRSxjQUNSQyxLQUFLLFdBa0NYLFNBQVNDLElBQ0RDLEdBNkRKQyxFQUFXQyxLQUFLLDJCQUEyQkMsS0FBSyxJQTVEaERDLEVBQVlILEVBQVdJLGFBQWVDLEVBQ3RDTCxFQUNLQyxLQUFLLHdCQUNMRyxZQUFZRSxFQUFhLEdBQUtILEdBQ25DSSxFQUFNVixLQUFLLFdBQ1BELEVBQUVGLE1BQU1VLFdBQVdELEtBR25CRyxFQUFhRCxJQUNUTixHQWlCWixXQUNJLElBQUlTLEVBQVcsR0FDWEMsSUFDQUQsRUFBVyw2SEFHZlIsRUFDS0MsS0FBSywyQkFDTEMsS0FDRyxxRkFHQU0sRUFDQSx3RkFJUlIsRUFDS0MsS0FBSyxTQUNMUyxNQUNBQyxHQUFHLFFBQVMsV0FDVEMsR0FBZ0IsS0FFeEJaLEVBQ0tDLEtBQUssVUFDTFMsTUFDQUMsR0FBRyxRQUFTLFdBQ1RDLEdBQWdCLEtBRXhCQyxJQUNJSixHQUFVSyxJQS9DQ0MsR0FDUEMsR0FxRFosV0FHSSxJQUFLLElBRkRDLEVBQU1qQixFQUFXQyxLQUFLLGtCQUN0QmlCLEVBQVEsR0FDSEMsRUFBSSxFQUFHQSxFQUFJYixFQUFZYSxJQUM1QkQsR0FBUyxvQkFBc0JDLEVBQUksV0FFdkNGLEVBQUlmLEtBQUtnQixHQUVURCxFQUNLaEIsS0FBSyxRQUNMbUIsUUFDQUMsU0FBUyxhQUNkckIsRUFDS0MsS0FBSyx1QkFDTFMsTUFDQUMsR0FBRyxRQUFTLFdBQ1RDLEdBQWdCLEdBQU9oQixFQUFFRixNQUFNNEIsS0FBSyxlQXJFOUJDLElBTWRDLEVBQWF4QixFQUFXeUIsY0FDeEJ6QixFQUFXQyxLQUFLLGtCQUFrQndCLFlBQVlELEdBMkdsRCxTQUFTWCxJQUNMLElBQUlhLEVBQU8xQixFQUFXQyxLQUFLLFNBQ3ZCMEIsRUFBUTNCLEVB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QixJQUVBRixPQUtaOUQsRUFBRSxtQkFBbUJlLEdBQUcsUUFBUyxXQUM3QnFCLEtBQUt1Qyx5QkFvQ2I3RSxLQUFLNkUsbUJBQXFCLFdBQ3RCM0UsRUFBRSx5QkFBeUJjLE1BQzNCZCxFQUFFLHdCQUF3QmMsTUFDMUJkLEVBQUUsbUJBQW1CYyxNQUNyQmQsRUFBRSxtQkFBbUJjLE1BQ3JCZCxFQUFFLGFBQWF1RSxTQUNmdkUsRUFBRSxvQkFBb0I0RSxPQUN0QnhDLEtBQUt5QyxhQUlUL0UsS0FBS3VDLGNBQWdCLFNBQVV3QixHQUMzQmlCLFFBQVFDLElBQUksYUFHaEJqRixLQUFLd0MsZUFBaUIsU0FBVXVCLEdBQzVCaUIsUUFBUUMsSUFBSSxjQUdoQmpGLEtBQUt5QyxXQUFhLFNBQVVzQixFQUFJbUIsRUFBT0MsR0FDbkMsR0FBSXBCLEVBQUd4RCxLQUFLLGtCQUFtQixDQUMzQixJQUFJZSxFQUFPeUMsRUFBR3hELEtBQUssdUJBQ25CZSxFQUFLWSxZQUFZLGFBQ2pCaEMsRUFBRW9CLEVBQUs2RCxJQUFXeEQsU0FBUyxhQUUvQm9DLEVBQ0t4RCxLQUFLLHdCQUNMb0UsSUFBSSxlQUF3QixFQUFUTyxFQUFhQyxFQUFXLE9BTXBEbkYsS0FBS29GLHdCQUEwQixTQUFVckIsR0FDckNBLEVBQUd4RCxLQUFLLCtCQUErQkosS0FBSyxXQUN4Q0QsRUFBRUYsTUFBTU8sS0FBSyxzQ0FBc0M4RSxNQUFNLG1EQUFxRG5GLEVBQUVGLE1BQU00RCxRQUFVLEdBQUssb0JBT3pJMUQsRUFBRSxPQUFPaUUsR0FBRywrQkFDWmpFLEVBQUUsOEJBQThCQyxLQUFLLFdBQ2pDbUMsS0FBSzhDLHdCQUF3QmxGLEVBQUVGLFNBSW5DRSxFQUFFLE9BQU9pRSxHQUFHLGVBQ1o3QixLQUFLckMiLCJmaWxlIjoiX3NsaWRlcl9fX19fX19fX19fXy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qXHJcbiAgICphbGwgc2xpZGVycyBjcmVhdGUgZnVuc1xyXG4gICAqIHBhcmFtc1xyXG4gICAqIGNvdW50IChudW0pICBmcm9tIDEgdG8gNCAtIGhvdyBtYWNoIGltZyBvbiBzbGlkZXIgc2NyZWVuXHJcbiAgICogYXJyb3cgKGJ1bGwpIGFycm93IGxlZnQgYW5kIHJpZ2h0XHJcbiAgICogZG90cyAoYnVsbCkgZG90cyBsaW5rXHJcbiAgICogKi9cclxudGhpcy5jcmVhdGVTbGlkZXJzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIGd0U2xpZGVycyA9ICQoXCIuZ3Qtc2xpZGVyXCIpO1xyXG4gICAgZ3RTbGlkZXJzLmVhY2goZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBjdXJyU2xpZGVyID0gJCh0aGlzKSxcclxuICAgICAgICAgICAgY3VyclBvc2l0aW9uID0gMCxcclxuICAgICAgICAgICAgYXJyb3cgPSBmYWxzZSxcclxuICAgICAgICAgICAgZG90cyA9IGZhbHNlLFxyXG4gICAgICAgICAgICBudW1QYW5lbCA9IGZhbHNlLFxyXG4gICAgICAgICAgICBzY3JlZW5Db25zdCxcclxuICAgICAgICAgICAgaW5uZXIgPSBjdXJyU2xpZGVyLmZpbmQoXCIuZ3Qtc2xpZGVyLWlubmVyXCIpLFxyXG4gICAgICAgICAgICBpbm5lckNvdW50ID0gaW5uZXIubGVuZ3RoLFxyXG4gICAgICAgICAgICBiYXNlV2lkdGgsXHJcbiAgICAgICAgICAgIGJhc2VIZWlnaHQ7XHJcbiAgICAgICAgaWYgKGN1cnJTbGlkZXIuaGFzQ2xhc3MoXCJndC1zbGlkZXItaGFzLWFycm93XCIpKSB7XHJcbiAgICAgICAgICAgIGFycm93ID0gdHJ1ZTtcclxuICAgICAgICAgICAgaWYgKGN1cnJTbGlkZXIuaGFzQ2xhc3MoXCJndC1zbGlkZXItbnVtXCIpKSB7XHJcbiAgICAgICAgICAgICAgICBudW1QYW5lbCA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY3VyclNsaWRlci5hcHBlbmQoJzxkaXYgY2xhc3M9XCJndC1zbGlkZXItYXJyb3ctaG9sZGVyXCI+PC9kaXY+Jyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChjdXJyU2xpZGVyLmhhc0NsYXNzKFwiZ3Qtc2xpZGVyLWhhcy1kb3RzXCIpKSB7XHJcbiAgICAgICAgICAgIGRvdHMgPSB0cnVlO1xyXG4gICAgICAgICAgICBjdXJyU2xpZGVyLmFwcGVuZCgnPGRpdiBjbGFzcz1cImd0LXNsaWRlci1uYXZcIj48L2Rpdj4nKTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAvLyBmdW5jdGlvbiBmaW5kU2NyZWVuQ29uc3QoKSB7XHJcbiAgICAgICAgLy8gICAgIHNjcmVlbkNvbnN0ID0gMTtcclxuICAgICAgICAvLyAgICAgaWYgKGN1cnJTbGlkZXIuYXR0cihcImRhdGEtY291bnRcIikpIHtcclxuICAgICAgICAvLyAgICAgICAgIHNjcmVlbkNvbnN0ID0gcGFyc2VJbnQoY3VyclNsaWRlci5hdHRyKFwiZGF0YS1jb3VudFwiKSk7XHJcbiAgICAgICAgLy8gICAgICAgICBpZiAoJCh0b2tlbjc2OCkuaXMoXCI6dmlzaWJsZVwiKSkgc2NyZWVuQ29uc3QgPSAzO1xyXG4gICAgICAgIC8vICAgICAgICAgaWYgKCQodG9rZW42NjcpLmlzKFwiOnZpc2libGVcIikpIHNjcmVlbkNvbnN0ID0gMjtcclxuICAgICAgICAvLyAgICAgICAgIGlmICgkKHRva2VuMzYwKS5pcyhcIjp2aXNpYmxlXCIpKSBzY3JlZW5Db25zdCA9IDE7XHJcbiAgICAgICAgLy8gICAgIH1cclxuICAgICAgICAvLyB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNldEJhc2VXaWR0aCgpIHtcclxuICAgICAgICAgICAgaWYgKGFycm93KSBkZXN0cm95QXJyb3coKTtcclxuICAgICAgICAgICAgYmFzZVdpZHRoID0gY3VyclNsaWRlci5vdXRlcldpZHRoKCkgLyBzY3JlZW5Db25zdDtcclxuICAgICAgICAgICAgY3VyclNsaWRlclxyXG4gICAgICAgICAgICAgICAgLmZpbmQoXCIuZ3Qtc2xpZGVyLWNvbnRhaW5lclwiKVxyXG4gICAgICAgICAgICAgICAgLm91dGVyV2lkdGgoKGlubmVyQ291bnQgKyAxKSAqIGJhc2VXaWR0aCk7XHJcbiAgICAgICAgICAgIGlubmVyLmVhY2goZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgJCh0aGlzKS5vdXRlcldpZHRoKGJhc2VXaWR0aCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgaWYgKGlubmVyQ291bnQgPiBzY3JlZW5Db25zdCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGFycm93KSBjcmVhdGVBcnJvd3MoKTtcclxuICAgICAgICAgICAgICAgIGlmIChkb3RzKSBjcmVhdGVEb3RzKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc2V0QmFzZUhlaWd0aCgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2V0QmFzZUhlaWd0aCgpIHtcclxuICAgICAgICAgICAgYmFzZUhlaWdodCA9IGN1cnJTbGlkZXIub3V0ZXJIZWlnaHQoKTtcclxuICAgICAgICAgICAgY3VyclNsaWRlci5maW5kKCcuZ3QtaW1nLWhvbGRlcicpLm91dGVySGVpZ2h0KGJhc2VIZWlnaHQpO1xyXG4gICAgICAgICAgICAvLyBjdXJyU2xpZGVyLmZpbmQoJy5ndC1pbWctaG9sZGVyLWFicycpLm91dGVySGVpZ2h0KGJhc2VIZWlnaHQpOz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZmluZFNjcmVlbkNvbnN0KCk7XHJcbiAgICAgICAgc2V0QmFzZVdpZHRoKCk7XHJcbiAgICAgICAgY3JlYXRlVG91Y2goKTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY3JlYXRlQXJyb3dzKCkge1xyXG4gICAgICAgICAgICB2YXIgbnVtSW5uZXIgPSAnJztcclxuICAgICAgICAgICAgaWYgKG51bVBhbmVsKSB7XHJcbiAgICAgICAgICAgICAgICBudW1Jbm5lciA9ICc8ZGl2IGNsYXNzPVwiZ3Qtc2xpZGVyLWFycm93LW51bVwiPjxpIGNsYXNzPVwiZ3Qtc2xpZGVyLW51bS1jdXJyXCI+MTwvaT4gPGk+0LjQtzwvaT4gPGkgY2xhc3M9XCJndC1zbGlkZXItbnVtLW1heFwiPjEwPC9pPiA8L2Rpdj4nXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGN1cnJTbGlkZXJcclxuICAgICAgICAgICAgICAgIC5maW5kKFwiLmd0LXNsaWRlci1hcnJvdy1ob2xkZXJcIilcclxuICAgICAgICAgICAgICAgIC5odG1sKFxyXG4gICAgICAgICAgICAgICAgICAgICc8c3BhbiBjbGFzcyA9IFwiZ3Qtc2xpZGVyLWFycm93IGxlZnRcIj4nICtcclxuICAgICAgICAgICAgICAgICAgICAnPGkgY2xhc3M9XCJmYSBmYS1hbmdsZS1sZWZ0IGZhLTJ4XCI+PC9pPicgK1xyXG4gICAgICAgICAgICAgICAgICAgIFwiPC9zcGFuPlwiICtcclxuICAgICAgICAgICAgICAgICAgICBudW1Jbm5lciArXHJcbiAgICAgICAgICAgICAgICAgICAgJzxzcGFuIGNsYXNzID0gXCJndC1zbGlkZXItYXJyb3cgcmlnaHRcIj4nICtcclxuICAgICAgICAgICAgICAgICAgICAnPGkgY2xhc3M9XCJmYSBmYS1hbmdsZS1yaWdodCBmYS0yeFwiPjwvaT4nICtcclxuICAgICAgICAgICAgICAgICAgICBcIjwvc3Bhbj5cIlxyXG4gICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgY3VyclNsaWRlclxyXG4gICAgICAgICAgICAgICAgLmZpbmQoXCIubGVmdFwiKVxyXG4gICAgICAgICAgICAgICAgLm9mZigpXHJcbiAgICAgICAgICAgICAgICAub24oXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb25lTW92ZUZ1bmN0aW9uKGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBjdXJyU2xpZGVyXHJcbiAgICAgICAgICAgICAgICAuZmluZChcIi5yaWdodFwiKVxyXG4gICAgICAgICAgICAgICAgLm9mZigpXHJcbiAgICAgICAgICAgICAgICAub24oXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb25lTW92ZUZ1bmN0aW9uKHRydWUpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGNoZWNrUG9zaXRpb24oKTtcclxuICAgICAgICAgICAgaWYgKG51bVBhbmVsKSBzaG93TnVtKClcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGRlc3Ryb3lBcnJvdygpIHtcclxuICAgICAgICAgICAgY3VyclNsaWRlci5maW5kKFwiLmd0LXNsaWRlci1hcnJvdy1ob2xkZXJcIikuaHRtbChcIlwiKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGNyZWF0ZURvdHMoKSB7XHJcbiAgICAgICAgICAgIHZhciBuYXYgPSBjdXJyU2xpZGVyLmZpbmQoXCIuZ3Qtc2xpZGVyLW5hdlwiKSxcclxuICAgICAgICAgICAgICAgIHNwYW5zID0gXCJcIjtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBpbm5lckNvdW50OyBpKyspIHtcclxuICAgICAgICAgICAgICAgIHNwYW5zICs9IFwiPHNwYW4gZGF0YS1udW0gPSBcIiArIGkgKyBcIj48L3NwYW4+XCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgbmF2Lmh0bWwoc3BhbnMpO1xyXG5cclxuICAgICAgICAgICAgbmF2XHJcbiAgICAgICAgICAgICAgICAuZmluZChcInNwYW5cIilcclxuICAgICAgICAgICAgICAgIC5maXJzdCgpXHJcbiAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoXCJndC1hY3RpdmVcIik7XHJcbiAgICAgICAgICAgIGN1cnJTbGlkZXJcclxuICAgICAgICAgICAgICAgIC5maW5kKFwiLmd0LXNsaWRlci1uYXYgc3BhblwiKVxyXG4gICAgICAgICAgICAgICAgLm9mZigpXHJcbiAgICAgICAgICAgICAgICAub24oXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb25lTW92ZUZ1bmN0aW9uKHRydWUsICskKHRoaXMpLmF0dHIoXCJkYXRhLW51bVwiKSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGNyZWF0ZVRvdWNoKCkge1xyXG4gICAgICAgICAgICB2YXIgaW5pdGlhbFBvaW50ID0gMCxcclxuICAgICAgICAgICAgICAgIGZpbmFsUG9pbnQgPSAwO1xyXG4gICAgICAgICAgICBjdXJyU2xpZGVyLm9uKFwidG91Y2hzdGFydFwiLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgIHZhciBlID0gZXZlbnQub3JpZ2luYWxFdmVudDtcclxuICAgICAgICAgICAgICAgIGluaXRpYWxQb2ludCA9IE1hdGguYWJzKGUudG91Y2hlc1swXS5wYWdlWCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBjdXJyU2xpZGVyLm9uKFwidG91Y2hlbmRcIiwgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZSA9IGV2ZW50Lm9yaWdpbmFsRXZlbnQ7XHJcbiAgICAgICAgICAgICAgICBmaW5hbFBvaW50ID0gTWF0aC5hYnMoZS5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoTWF0aC5hYnMoaW5pdGlhbFBvaW50IC0gZmluYWxQb2ludCkgPiA1MCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpbml0aWFsUG9pbnQgPiBmaW5hbFBvaW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uZU1vdmVGdW5jdGlvbihmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb25lTW92ZUZ1bmN0aW9uKHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcblxyXG4gICAgICAgIC8vLy8vLy8vLy8vXHJcblxyXG4gICAgICAgIGlmIChjdXJyU2xpZGVyLmZpbmQoXCIuZ3Qtc2xpZGVyLW9wZW4tY2xvbmVcIikpIGNyZWF0ZUNsb25lTGlzdGVuZXJzKCk7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGNyZWF0ZUNsb25lTGlzdGVuZXJzKCkge1xyXG4gICAgICAgICAgICB2YXIgY2xvbmVMaXN0ZW5lcnMgPSBjdXJyU2xpZGVyLmZpbmQoXCIuZ3Qtc2xpZGVyLW9wZW4tY2xvbmVcIik7XHJcbiAgICAgICAgICAgIGNsb25lTGlzdGVuZXJzLmVhY2goZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgJCh0aGlzKS5vbihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnY2xvbmVMaXN0ZW5lcnMnLCAkKHRoaXMpLnBhcmVudCgpLmluZGV4KCkpXHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5jcmVhdGVDbG9uZVNsaWRlcihcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3VyclNsaWRlcixcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnBhcmVudCgpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuaW5kZXgoKVxyXG4gICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBjaGVja1Bvc2l0aW9uKCkge1xyXG4gICAgICAgICAgICB2YXIgbGVmdCA9IGN1cnJTbGlkZXIuZmluZChcIi5sZWZ0XCIpLFxyXG4gICAgICAgICAgICAgICAgcmlnaHQgPSBjdXJyU2xpZGVyLmZpbmQoXCIucmlnaHRcIik7XHJcbiAgICAgICAgICAgIHJpZ2h0LnJlbW92ZUNsYXNzKFwibm90LWFjdGl2ZVwiKTtcclxuICAgICAgICAgICAgbGVmdC5yZW1vdmVDbGFzcyhcIm5vdC1hY3RpdmVcIik7XHJcbiAgICAgICAgICAgIGlmIChjdXJyUG9zaXRpb24gPT0gMCkgbGVmdC5hZGRDbGFzcyhcIm5vdC1hY3RpdmVcIik7XHJcbiAgICAgICAgICAgIGlmIChcclxuICAgICAgICAgICAgICAgIGN1cnJQb3NpdGlvbiA9PSBpbm5lckNvdW50IC0gMSB8fFxyXG4gICAgICAgICAgICAgICAgY3VyclBvc2l0aW9uID09IGlubmVyQ291bnQgLSBzY3JlZW5Db25zdFxyXG4gICAgICAgICAgICApXHJcbiAgICAgICAgICAgICAgICByaWdodC5hZGRDbGFzcyhcIm5vdC1hY3RpdmVcIik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBvbmVNb3ZlRnVuY3Rpb24oYnVsLCBudW0pIHtcclxuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coYXJyb3cpO1xyXG4gICAgICAgICAgICBpZiAobnVtIHx8IG51bSA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgY3VyclBvc2l0aW9uID0gbnVtO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGJ1bCkge1xyXG4gICAgICAgICAgICAgICAgY3VyclBvc2l0aW9uICs9IDE7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjdXJyUG9zaXRpb24gLT0gMTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoY3VyclBvc2l0aW9uID4gaW5uZXJDb3VudCAtIHNjcmVlbkNvbnN0KSB7XHJcbiAgICAgICAgICAgICAgICBjdXJyUG9zaXRpb24gPSBpbm5lckNvdW50IC0gc2NyZWVuQ29uc3Q7XHJcbiAgICAgICAgICAgICAgICBzZWxmLnNsaWRlckVuZExlZnQoY3VyclNsaWRlcik7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGN1cnJQb3NpdGlvbiA8IDApIHtcclxuICAgICAgICAgICAgICAgIGN1cnJQb3NpdGlvbiA9IDA7XHJcbiAgICAgICAgICAgICAgICBzZWxmLnNsaWRlckVuZFJpZ2h0KGN1cnJTbGlkZXIpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHNlbGYuc2xpZGVyTW92ZShjdXJyU2xpZGVyLCBiYXNlV2lkdGgsIGN1cnJQb3NpdGlvbik7XHJcblxyXG5cclxuICAgICAgICAgICAgaWYgKGFycm93KSBjaGVja1Bvc2l0aW9uKCk7XHJcbiAgICAgICAgICAgIGlmIChudW1QYW5lbCkgc2hvd051bSgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2hvd051bSgpIHtcclxuICAgICAgICAgICAgY3VyclNsaWRlci5maW5kKCcuZ3Qtc2xpZGVyLW51bS1jdXJyJykudGV4dChjdXJyUG9zaXRpb24gKyAxKTtcclxuICAgICAgICAgICAgY3VyclNsaWRlci5maW5kKCcuZ3Qtc2xpZGVyLW51bS1tYXgnKS50ZXh0KGlubmVyQ291bnQpO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICQod2luZG93KS5yZXNpemUoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBmaW5kU2NyZWVuQ29uc3QoKTtcclxuICAgICAgICAgICAgc2V0QmFzZVdpZHRoKCk7XHJcbiAgICAgICAgICAgIGlmIChjdXJyUG9zaXRpb24gPiBpbm5lckNvdW50IC0gc2NyZWVuQ29uc3QpXHJcbiAgICAgICAgICAgICAgICBjdXJyUG9zaXRpb24gPSBpbm5lckNvdW50IC0gc2NyZWVuQ29uc3Q7XHJcbiAgICAgICAgICAgIGlmIChpbm5lckNvdW50IDw9IHNjcmVlbkNvbnN0KSBjdXJyUG9zaXRpb24gPSAwO1xyXG4gICAgICAgICAgICBzZWxmLnNsaWRlck1vdmUoY3VyclNsaWRlciwgYmFzZVdpZHRoLCBjdXJyUG9zaXRpb24pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbn07XHJcblxyXG50aGlzLmNyZWF0ZUNsb25lU2xpZGVyID0gZnVuY3Rpb24gKGVsLCBudW0pIHtcclxuICAgIGlmICgkKFwiZGl2XCIpLmlzKFwiI2d0LWNsb25lXCIpKSByZXR1cm47XHJcbiAgICBzZWxmLmZpeEJvZHkoKTtcclxuICAgIHZhciBjdXJyUG9zaXRpb24gPSBudW07XHJcbiAgICAkKFwiI2d0LWJvZHktd3JhcHBlclwiKVxyXG4gICAgICAgIC5zaG93KClcclxuICAgICAgICAuYXBwZW5kKFxyXG4gICAgICAgICAgICBcIlwiICtcclxuICAgICAgICAgICAgJzxkaXYgaWQgPSBcImd0LWNsb25lXCIgY2xhc3M9XCJndC1zbGlkZXItY2xvbmVcIj4nICtcclxuICAgICAgICAgICAgJzxkaXYgaWQgPSBcImd0LWNsb25lLWNsb3NlXCIgY2xhc3MgPSBcImd0LXNsaWRlci1jbG9uZS1jbG9zZVwiPicgK1xyXG4gICAgICAgICAgICBcIjwvZGl2PlwiICtcclxuICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJjb250YWluZXJcIj4nICtcclxuICAgICAgICAgICAgJzxkaXYgaWQgPSBcImd0LWNsb25lLWlubmVyXCIgY2xhc3MgPSBcImd0LXNsaWRlci1jbG9uZS1pbm5lclwiPicgK1xyXG4gICAgICAgICAgICAnPGRpdiBpZCA9IFwiZ3QtY2xvbmUtY29udGFpbmVyXCIgY2xhc3MgPSBcImd0LXNsaWRlci1jb250YWluZXIgZ3Qtc2xpZGVyLWNsb25lLWNvbnRhaW5lclwiPjwvZGl2PicgK1xyXG4gICAgICAgICAgICBcIjwvZGl2PlwiICtcclxuICAgICAgICAgICAgXCI8L2Rpdj5cIiArXHJcbiAgICAgICAgICAgIFwiPC9kaXY+XCJcclxuICAgICAgICApO1xyXG4gICAgdmFyIGN1cnJTbGlkZXIgPSAkKFwiI2d0LWNsb25lLWlubmVyXCIpLFxyXG4gICAgICAgIGlubmVycyA9IGVsLmZpbmQoXCIuZ3Qtc2xpZGVyLWlubmVyXCIpLmNsb25lKHRydWUpLFxyXG4gICAgICAgIGlubmVyc0xlbmdodCA9IGlubmVycy5sZW5ndGg7XHJcbiAgICBpbm5lcnMuZWFjaChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgJCh0aGlzKVxyXG4gICAgICAgICAgICAucmVtb3ZlQ2xhc3MoXCJndC1zbGlkZXItaW5uZXJcIilcclxuICAgICAgICAgICAgLmFkZENsYXNzKFwiZ3QtY2xvbmUtc2xpZGVyLWlubmVyXCIpO1xyXG4gICAgICAgICQodGhpcylcclxuICAgICAgICAgICAgLmZpbmQoXCIuZ3Qtc2xpZGVyLWlubmVyLWNvdmVyXCIpXHJcbiAgICAgICAgICAgIC5yZW1vdmUoKTtcclxuICAgICAgICAkKFwiI2d0LWNsb25lLWNvbnRhaW5lclwiKS5hcHBlbmQoJCh0aGlzKSk7XHJcbiAgICB9KTtcclxuICAgIGlmIChpbm5lcnNMZW5naHQgPiAxKSB7XHJcbiAgICAgICAgJChcIiNndC1jbG9uZSAuY29udGFpbmVyXCIpLmFwcGVuZChcclxuICAgICAgICAgICAgJzxzcGFuIGNsYXNzID0gXCJndC1zbGlkZXItYXJyb3cgbGVmdFwiIGlkID0gXCJndC1jbG9uZS1hcnJvdy1sZWZ0XCI+JyArXHJcbiAgICAgICAgICAgICc8aSBjbGFzcz1cImZhIGZhLWFuZ2xlLWxlZnQgZmEtMnhcIj48L2k+JyArXHJcbiAgICAgICAgICAgIFwiPC9zcGFuPlwiICtcclxuICAgICAgICAgICAgJzxzcGFuIGNsYXNzID0gXCJndC1zbGlkZXItYXJyb3cgcmlnaHRcIiBpZCA9IFwiZ3QtY2xvbmUtYXJyb3ctcmlnaHRcIj4nICtcclxuICAgICAgICAgICAgJzxpIGNsYXNzPVwiZmEgZmEtYW5nbGUtcmlnaHQgZmEtMnhcIj48L2k+JyArXHJcbiAgICAgICAgICAgIFwiPC9zcGFuPlwiXHJcbiAgICAgICAgKTtcclxuICAgICAgICAkKFwiI2d0LWNsb25lLWFycm93LWxlZnRcIikub24oXCJjbGlja1wiLCBtb3ZlQ2xvbmVTbGlkZXJMZWZ0KTtcclxuICAgICAgICAkKFwiI2d0LWNsb25lLWFycm93LXJpZ2h0XCIpLm9uKFwiY2xpY2tcIiwgbW92ZUNsb25lU2xpZGVyUmlnaHQpO1xyXG4gICAgfVxyXG5cclxuICAgIHZhciBjb250YWluZXIgPSBjdXJyU2xpZGVyLmZpbmQoXCIjZ3QtY2xvbmUtY29udGFpbmVyXCIpLFxyXG4gICAgICAgIC8vIGlubmVycyA9IGNvbnRhaW5lci5maW5kKCcuZ3QtY2xvbmUtc2xpZGVyLWlubmVyJyksXHJcbiAgICAgICAgaW5uZXJMZW5ndGggPSBpbm5lcnMubGVuZ3RoLFxyXG4gICAgICAgIGJhc2VXaWR0aCA9IGN1cnJTbGlkZXIub3V0ZXJXaWR0aCgpO1xyXG5cclxuICAgIGlubmVycy5lYWNoKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAkKHRoaXMpLm91dGVyV2lkdGgoYmFzZVdpZHRoKTtcclxuICAgIH0pO1xyXG4gICAgY29udGFpbmVyLm91dGVyV2lkdGgoYmFzZVdpZHRoICogKGlubmVyTGVuZ3RoICsgMSkpO1xyXG4gICAgY29udGFpbmVyLmNzcyhcIm1hcmdpbi1sZWZ0XCIsIGJhc2VXaWR0aCAqIC0xICogY3VyclBvc2l0aW9uICsgXCJweFwiKTtcclxuICAgIHNldFRpbWVvdXQoYWRkQW5pbWF0aW9uKTtcclxuXHJcbiAgICBmdW5jdGlvbiBhZGRBbmltYXRpb24oKSB7XHJcbiAgICAgICAgY29udGFpbmVyLmFkZENsYXNzKFwiZ3QtYW5pbWF0ZWRcIik7XHJcbiAgICB9XHJcblxyXG4gICAgY2hlY2tQb3NpdGlvbigpO1xyXG4gICAgdmFyIGluaXRpYWxQb2ludCA9IDAsXHJcbiAgICAgICAgZmluYWxQb2ludCA9IDA7XHJcbiAgICBjdXJyU2xpZGVyLm9uKFwidG91Y2hzdGFydFwiLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICB2YXIgZSA9IGV2ZW50Lm9yaWdpbmFsRXZlbnQ7XHJcbiAgICAgICAgaW5pdGlhbFBvaW50ID0gTWF0aC5hYnMoZS50b3VjaGVzWzBdLnBhZ2VYKTtcclxuICAgIH0pO1xyXG4gICAgY3VyclNsaWRlci5vbihcInRvdWNoZW5kXCIsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgIHZhciBlID0gZXZlbnQub3JpZ2luYWxFdmVudDtcclxuICAgICAgICBmaW5hbFBvaW50ID0gTWF0aC5hYnMoZS5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWCk7XHJcbiAgICAgICAgaWYgKE1hdGguYWJzKGluaXRpYWxQb2ludCAtIGZpbmFsUG9pbnQpID4gNTApIHtcclxuICAgICAgICAgICAgaWYgKGluaXRpYWxQb2ludCA+IGZpbmFsUG9pbnQpIHtcclxuICAgICAgICAgICAgICAgIG1vdmVDbG9uZVNsaWRlckxlZnQoKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIG1vdmVDbG9uZVNsaWRlclJpZ2h0KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICAkKFwiI2d0LWNsb25lLWNsb3NlXCIpLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHNlbGYuZGVzdHJveUNsb25lU2xpZGVyKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBmdW5jdGlvbiBtb3ZlQ2xvbmVTbGlkZXJSaWdodCgpIHtcclxuICAgICAgICBjdXJyUG9zaXRpb24gKz0gMTtcclxuICAgICAgICBpZiAoY3VyclBvc2l0aW9uID4gaW5uZXJMZW5ndGggLSAxKSB7XHJcbiAgICAgICAgICAgIGN1cnJQb3NpdGlvbiA9IGlubmVyTGVuZ3RoIC0gMTtcclxuICAgICAgICAgICAgc2VsZi5zbGlkZXJFbmRSaWdodChjdXJyU2xpZGVyKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBzZWxmLnNsaWRlck1vdmUoY3VyclNsaWRlciwgYmFzZVdpZHRoLCBjdXJyUG9zaXRpb24pO1xyXG4gICAgICAgIGNoZWNrUG9zaXRpb24oKTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBtb3ZlQ2xvbmVTbGlkZXJMZWZ0KCkge1xyXG4gICAgICAgIGN1cnJQb3NpdGlvbiAtPSAxO1xyXG4gICAgICAgIGlmIChjdXJyUG9zaXRpb24gPCAwKSB7XHJcbiAgICAgICAgICAgIGN1cnJQb3NpdGlvbiA9IDA7XHJcbiAgICAgICAgICAgIHNlbGYuc2xpZGVyRW5kTGVmdChjdXJyU2xpZGVyKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBzZWxmLnNsaWRlck1vdmUoY3VyclNsaWRlciwgYmFzZVdpZHRoLCBjdXJyUG9zaXRpb24pO1xyXG4gICAgICAgIGNoZWNrUG9zaXRpb24oKTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBjaGVja1Bvc2l0aW9uKCkge1xyXG4gICAgICAgIGlmICghJChcIiNndC1jbG9uZS1hcnJvdy1sZWZ0XCIpKSByZXR1cm47XHJcbiAgICAgICAgdmFyIGxlZnQgPSAkKFwiI2d0LWNsb25lLWFycm93LWxlZnRcIiksXHJcbiAgICAgICAgICAgIHJpZ2h0ID0gJChcIiNndC1jbG9uZS1hcnJvdy1yaWdodFwiKTtcclxuICAgICAgICByaWdodC5yZW1vdmVDbGFzcyhcIm5vdC1hY3RpdmVcIik7XHJcbiAgICAgICAgbGVmdC5yZW1vdmVDbGFzcyhcIm5vdC1hY3RpdmVcIik7XHJcbiAgICAgICAgaWYgKGN1cnJQb3NpdGlvbiA9PSAwKSBsZWZ0LmFkZENsYXNzKFwibm90LWFjdGl2ZVwiKTtcclxuICAgICAgICBpZiAoY3VyclBvc2l0aW9uID09IGlubmVyTGVuZ3RoIC0gMSkgcmlnaHQuYWRkQ2xhc3MoXCJub3QtYWN0aXZlXCIpO1xyXG4gICAgfVxyXG59O1xyXG5cclxudGhpcy5kZXN0cm95Q2xvbmVTbGlkZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAkKFwiI2d0LWNsb25lLWFycm93LXJpZ2h0XCIpLm9mZigpO1xyXG4gICAgJChcIiNndC1jbG9uZS1hcnJvdy1sZWZ0XCIpLm9mZigpO1xyXG4gICAgJChcIiNndC1jbG9uZS1jbG9zZVwiKS5vZmYoKTtcclxuICAgICQoXCIjZ3QtY2xvbmUtaW5uZXJcIikub2ZmKCk7XHJcbiAgICAkKFwiI2d0LWNsb25lXCIpLnJlbW92ZSgpO1xyXG4gICAgJChcIiNndC1ib2R5LXdyYXBwZXJcIikuaGlkZSgpO1xyXG4gICAgc2VsZi51bmZpeEJvZHkoKTtcclxufTtcclxuXHJcblxyXG50aGlzLnNsaWRlckVuZExlZnQgPSBmdW5jdGlvbiAoZWwpIHtcclxuICAgIGNvbnNvbGUubG9nKFwibGVmdF9lbmRcIik7XHJcbn07XHJcblxyXG50aGlzLnNsaWRlckVuZFJpZ2h0ID0gZnVuY3Rpb24gKGVsKSB7XHJcbiAgICBjb25zb2xlLmxvZyhcInJpZ2h0X2VuZFwiKTtcclxufTtcclxuXHJcbnRoaXMuc2xpZGVyTW92ZSA9IGZ1bmN0aW9uIChlbCwgd2lkdGgsIHBvc2l0aW9uKSB7XHJcbiAgICBpZiAoZWwuZmluZChcIi5ndC1zbGlkZXItbmF2XCIpKSB7XHJcbiAgICAgICAgdmFyIGRvdHMgPSBlbC5maW5kKFwiLmd0LXNsaWRlci1uYXYgc3BhblwiKTtcclxuICAgICAgICBkb3RzLnJlbW92ZUNsYXNzKFwiZ3QtYWN0aXZlXCIpO1xyXG4gICAgICAgICQoZG90c1twb3NpdGlvbl0pLmFkZENsYXNzKFwiZ3QtYWN0aXZlXCIpO1xyXG4gICAgfVxyXG4gICAgZWxcclxuICAgICAgICAuZmluZChcIi5ndC1zbGlkZXItY29udGFpbmVyXCIpXHJcbiAgICAgICAgLmNzcyhcIm1hcmdpbi1sZWZ0XCIsIHdpZHRoICogLTEgKiBwb3NpdGlvbiArIFwicHhcIik7XHJcbn07XHJcblxyXG5cclxuXHJcblxyXG50aGlzLm51bWJlckNvbGxlY3Rpb25BcnRpY2xlID0gZnVuY3Rpb24gKGVsKSB7XHJcbiAgICBlbC5maW5kKFwiLmd0LWNvbGxlY3Rpb24tbGluay13cmFwcGVyXCIpLmVhY2goZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICQodGhpcykuZmluZCgnLmd0LWNvbGxlY3Rpb24tbGluay1zbGlkZXItd3JhcHBlcicpLmFmdGVyKCc8ZGl2IGNsYXNzID0gXCJndC1jb2xsZWN0aW9uLWxpbmstbnVtYmVyXCI+PHNwYW4+JyArICgkKHRoaXMpLmluZGV4KCkgKyAxKSArICc8L3NwYW4+PC9kaXY+JylcclxuICAgICAgICAvLyBjb25zb2xlLmxvZygkKHRoaXMpKTtcclxuICAgIH0pO1xyXG59O1xyXG5cclxuXHJcblxyXG5pZiAoJChcImRpdlwiKS5pcyhcIi5ndC1jb2xsZWN0aW9uLXdyYXBwZXItbnVtXCIpKSB7XHJcbiAgICAkKFwiLmd0LWNvbGxlY3Rpb24td3JhcHBlci1udW1cIikuZWFjaChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgc2VsZi5udW1iZXJDb2xsZWN0aW9uQXJ0aWNsZSgkKHRoaXMpKTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5pZiAoJChcImRpdlwiKS5pcyhcIi5ndC1zbGlkZXJcIikpIHtcclxuICAgIHNlbGYuY3JlYXRlU2xpZGVycygpO1xyXG59Il19
