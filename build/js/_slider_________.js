this.createSliders=function(){$(".gt-slider").each(function(){function i(){o=1,a.attr("data-count")&&(o=parseInt(a.attr("data-count")),$(token768).is(":visible")&&(o=3),$(token667).is(":visible")&&(o=2),$(token360).is(":visible")&&(o=1))}function n(){c&&a.find(".gt-slider-arrow-holder").html(""),l=a.outerWidth()/o,a.find(".gt-slider-container").outerWidth((v+1)*l),h.each(function(){$(this).outerWidth(l)}),v>o&&(c&&function(){var i="";g&&(i='<div class="gt-slider-arrow-num"><i class="gt-slider-num-curr">1</i> <i>из</i> <i class="gt-slider-num-max">10</i> </div>');a.find(".gt-slider-arrow-holder").html('<span class = "gt-slider-arrow left"><i class="fa fa-angle-left fa-2x"></i></span>'+i+'<span class = "gt-slider-arrow right"><i class="fa fa-angle-right fa-2x"></i></span>'),a.find(".left").off().on("click",function(){t(!1)}),a.find(".right").off().on("click",function(){t(!0)}),e(),g&&s()}(),f&&function(){for(var i=a.find(".gt-slider-nav"),n="",e=0;e<v;e++)n+="<span data-num = "+e+"></span>";i.html(n),i.find("span").first().addClass("gt-active"),a.find(".gt-slider-nav span").off().on("click",function(){t(!0,+$(this).attr("data-num"))})}()),r=a.outerHeight(),a.find(".gt-img-holder").outerHeight(r)}function e(){var i=a.find(".left"),n=a.find(".right");n.removeClass("not-active"),i.removeClass("not-active"),0==d&&i.addClass("not-active"),d!=v-1&&d!=v-o||n.addClass("not-active")}function t(i,n){return n||0===n?d=n:i?d+=1:d-=1,d>v-o?(d=v-o,void self.sliderEndLeft(a)):d<0?(d=0,void self.sliderEndRight(a)):(self.sliderMove(a,l,d),c&&e(),void(g&&s()))}function s(){a.find(".gt-slider-num-curr").text(d+1),a.find(".gt-slider-num-max").text(v)}var o,l,r,a=$(this),d=0,c=!1,f=!1,g=!1,h=a.find(".gt-slider-inner"),v=h.length;a.hasClass("gt-slider-has-arrow")&&(c=!0,a.hasClass("gt-slider-num")&&(g=!0),a.append('<div class="gt-slider-arrow-holder"></div>')),a.hasClass("gt-slider-has-dots")&&(f=!0,a.append('<div class="gt-slider-nav"></div>')),i(),n(),function(){var i=0,n=0;a.on("touchstart",function(n){var e=n.originalEvent;i=Math.abs(e.touches[0].pageX)}),a.on("touchend",function(e){var s=e.originalEvent;n=Math.abs(s.changedTouches[0].pageX),Math.abs(i-n)>50&&t(!(i>n))})}(),a.find(".gt-slider-open-clone")&&a.find(".gt-slider-open-clone").each(function(){$(this).on("click",function(){self.createCloneSlider(a,$(this).parent().index())})}),$(window).resize(function(){i(),n(),d>v-o&&(d=v-o),v<=o&&(d=0),self.sliderMove(a,l,d)})})},this.createCloneSlider=function(i,n){function e(){if((o+=1)>c-1)return o=c-1,void self.sliderEndRight(l);self.sliderMove(l,f,o),s()}function t(){if((o-=1)<0)return o=0,void self.sliderEndLeft(l);self.sliderMove(l,f,o),s()}function s(){if($("#gt-clone-arrow-left")){var i=$("#gt-clone-arrow-left"),n=$("#gt-clone-arrow-right");n.removeClass("not-active"),i.removeClass("not-active"),0==o&&i.addClass("not-active"),o==c-1&&n.addClass("not-active")}}if(!$("div").is("#gt-clone-close")){self.fixBody();var o=n;$("#gt-body-wrapper").show().append('<div id = "gt-clone" class="gt-slider-clone"><div id = "gt-clone-close" class = "gt-slider-clone-close"></div><div class="container"><div id = "gt-clone-inner" class = "gt-slider-clone-inner"><div id = "gt-clone-container" class = "gt-slider-container gt-slider-clone-container"></div></div></div></div>');var l=$("#gt-clone-inner"),r=i.find(".gt-slider-inner").clone(!0),a=r.length;r.each(function(){$(this).removeClass("gt-slider-inner").addClass("gt-clone-slider-inner"),$(this).find(".gt-slider-inner-cover").remove(),$("#gt-clone-container").append($(this))}),a>1&&($("#gt-clone .container").append('<span class = "gt-slider-arrow left" id = "gt-clone-arrow-left"><i class="fa fa-angle-left fa-2x"></i></span><span class = "gt-slider-arrow right" id = "gt-clone-arrow-right"><i class="fa fa-angle-right fa-2x"></i></span>'),$("#gt-clone-arrow-left").on("click",t),$("#gt-clone-arrow-right").on("click",e));var d=l.find("#gt-clone-container"),c=r.length,f=l.outerWidth();r.each(function(){$(this).outerWidth(f)}),d.outerWidth(f*(c+1)),d.css("margin-left",-1*f*o+"px"),setTimeout(function(){d.addClass("gt-animated")}),s();var g=0,h=0;l.on("touchstart",function(i){var n=i.originalEvent;g=Math.abs(n.touches[0].pageX)}),l.on("touchend",function(i){var n=i.originalEvent;h=Math.abs(n.changedTouches[0].pageX),Math.abs(g-h)>50&&(g>h?t():e())}),$("#gt-clone-close").on("click",function(){self.destroyCloneSlider()})}},this.destroyCloneSlider=function(){$("#gt-clone-arrow-right").off(),$("#gt-clone-arrow-left").off(),$("#gt-clone-close").off(),$("#gt-clone-inner").off(),$("#gt-clone").remove(),$("#gt-body-wrapper").hide(),self.unfixBody()},this.sliderEndLeft=function(i){console.log("left_end")},this.sliderEndRight=function(i){console.log("right_end")},this.sliderMove=function(i,n,e){if(i.find(".gt-slider-nav")){var t=i.find(".gt-slider-nav span");t.removeClass("gt-active"),$(t[e]).addClass("gt-active")}i.find(".gt-slider-container").css("margin-left",-1*n*e+"px")},this.numberCollectionArticle=function(i){i.find(".gt-collection-link-wrapper").each(function(){$(this).find(".gt-collection-link-slider-wrapper").after('<div class = "gt-collection-link-number"><span>'+($(this).index()+1)+"</span></div>")})},$("div").is(".gt-collection-wrapper-num")&&$(".gt-collection-wrapper-num").each(function(){self.numberCollectionArticle($(this))}),$("div").is(".gt-slider")&&self.createSliders();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIl9zbGlkZXJfX19fX19fX18uanMiXSwibmFtZXMiOlsidGhpcyIsImNyZWF0ZVNsaWRlcnMiLCIkIiwiZWFjaCIsImZpbmRTY3JlZW5Db25zdCIsInNjcmVlbkNvbnN0IiwiY3VyclNsaWRlciIsImF0dHIiLCJwYXJzZUludCIsInRva2VuNzY4IiwiaXMiLCJ0b2tlbjY2NyIsInRva2VuMzYwIiwic2V0QmFzZVdpZHRoIiwiYXJyb3ciLCJmaW5kIiwiaHRtbCIsImJhc2VXaWR0aCIsIm91dGVyV2lkdGgiLCJpbm5lckNvdW50IiwiaW5uZXIiLCJudW1Jbm5lciIsIm51bVBhbmVsIiwib2ZmIiwib24iLCJvbmVNb3ZlRnVuY3Rpb24iLCJjaGVja1Bvc2l0aW9uIiwic2hvd051bSIsImNyZWF0ZUFycm93cyIsImRvdHMiLCJuYXYiLCJzcGFucyIsImkiLCJmaXJzdCIsImFkZENsYXNzIiwiY3JlYXRlRG90cyIsImJhc2VIZWlnaHQiLCJvdXRlckhlaWdodCIsImxlZnQiLCJyaWdodCIsInJlbW92ZUNsYXNzIiwiY3VyclBvc2l0aW9uIiwiYnVsIiwibnVtIiwic2VsZiIsInNsaWRlckVuZExlZnQiLCJzbGlkZXJFbmRSaWdodCIsInNsaWRlck1vdmUiLCJ0ZXh0IiwibGVuZ3RoIiwiaGFzQ2xhc3MiLCJhcHBlbmQiLCJpbml0aWFsUG9pbnQiLCJmaW5hbFBvaW50IiwiZXZlbnQiLCJlIiwib3JpZ2luYWxFdmVudCIsIk1hdGgiLCJhYnMiLCJ0b3VjaGVzIiwicGFnZVgiLCJjaGFuZ2VkVG91Y2hlcyIsImNyZWF0ZVRvdWNoIiwiY3JlYXRlQ2xvbmVTbGlkZXIiLCJwYXJlbnQiLCJpbmRleCIsIndpbmRvdyIsInJlc2l6ZSIsImVsIiwibW92ZUNsb25lU2xpZGVyUmlnaHQiLCJpbm5lckxlbmd0aCIsIm1vdmVDbG9uZVNsaWRlckxlZnQiLCJmaXhCb2R5Iiwic2hvdyIsImlubmVycyIsImNsb25lIiwiaW5uZXJzTGVuZ2h0IiwicmVtb3ZlIiwiY29udGFpbmVyIiwiY3NzIiwic2V0VGltZW91dCIsImRlc3Ryb3lDbG9uZVNsaWRlciIsImhpZGUiLCJ1bmZpeEJvZHkiLCJjb25zb2xlIiwibG9nIiwid2lkdGgiLCJwb3NpdGlvbiIsIm51bWJlckNvbGxlY3Rpb25BcnRpY2xlIiwiYWZ0ZXIiXSwibWFwcGluZ3MiOiJBQU9BQSxLQUFLQyxjQUFnQixXQUNEQyxFQUFFLGNBQ1JDLEtBQUssV0F3QlgsU0FBU0MsSUFDTEMsRUFBYyxFQUNWQyxFQUFXQyxLQUFLLGdCQUNoQkYsRUFBY0csU0FBU0YsRUFBV0MsS0FBSyxlQUNuQ0wsRUFBRU8sVUFBVUMsR0FBRyxjQUFhTCxFQUFjLEdBQzFDSCxFQUFFUyxVQUFVRCxHQUFHLGNBQWFMLEVBQWMsR0FDMUNILEVBQUVVLFVBQVVGLEdBQUcsY0FBYUwsRUFBYyxJQUl0RCxTQUFTUSxJQUNEQyxHQTZESlIsRUFBV1MsS0FBSywyQkFBMkJDLEtBQUssSUE1RGhEQyxFQUFZWCxFQUFXWSxhQUFlYixFQUN0Q0MsRUFDS1MsS0FBSyx3QkFDTEcsWUFBWUMsRUFBYSxHQUFLRixHQUNuQ0csRUFBTWpCLEtBQUssV0FDUEQsRUFBRUYsTUFBTWtCLFdBQVdELEtBR25CRSxFQUFhZCxJQUNUUyxHQWlCWixXQUNJLElBQUlPLEVBQVcsR0FDWEMsSUFDQUQsRUFBVyw2SEFHZmYsRUFDS1MsS0FBSywyQkFDTEMsS0FDRyxxRkFHQUssRUFDQSx3RkFJUmYsRUFDS1MsS0FBSyxTQUNMUSxNQUNBQyxHQUFHLFFBQVMsV0FDVEMsR0FBZ0IsS0FFeEJuQixFQUNLUyxLQUFLLFVBQ0xRLE1BQ0FDLEdBQUcsUUFBUyxXQUNUQyxHQUFnQixLQUV4QkMsSUFDSUosR0FBVUssSUEvQ0NDLEdBQ1BDLEdBcURaLFdBR0ksSUFBSyxJQUZEQyxFQUFNeEIsRUFBV1MsS0FBSyxrQkFDdEJnQixFQUFRLEdBQ0hDLEVBQUksRUFBR0EsRUFBSWIsRUFBWWEsSUFDNUJELEdBQVMsb0JBQXNCQyxFQUFJLFdBRXZDRixFQUFJZCxLQUFLZSxHQUVURCxFQUNLZixLQUFL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QUcsK0JBQ1pSLEVBQUUsOEJBQThCQyxLQUFLLFdBQ2pDeUMsS0FBSzRDLHdCQUF3QnRGLEVBQUVGLFNBSW5DRSxFQUFFLE9BQU9RLEdBQUcsZUFDWmtDLEtBQUszQyIsImZpbGUiOiJfc2xpZGVyX19fX19fX19fLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLypcclxuICAgKmFsbCBzbGlkZXJzIGNyZWF0ZSBmdW5zXHJcbiAgICogcGFyYW1zXHJcbiAgICogY291bnQgKG51bSkgIGZyb20gMSB0byA0IC0gaG93IG1hY2ggaW1nIG9uIHNsaWRlciBzY3JlZW5cclxuICAgKiBhcnJvdyAoYnVsbCkgYXJyb3cgbGVmdCBhbmQgcmlnaHRcclxuICAgKiBkb3RzIChidWxsKSBkb3RzIGxpbmtcclxuICAgKiAqL1xyXG50aGlzLmNyZWF0ZVNsaWRlcnMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgZ3RTbGlkZXJzID0gJChcIi5ndC1zbGlkZXJcIik7XHJcbiAgICBndFNsaWRlcnMuZWFjaChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGN1cnJTbGlkZXIgPSAkKHRoaXMpLFxyXG4gICAgICAgICAgICBjdXJyUG9zaXRpb24gPSAwLFxyXG4gICAgICAgICAgICBhcnJvdyA9IGZhbHNlLFxyXG4gICAgICAgICAgICBkb3RzID0gZmFsc2UsXHJcbiAgICAgICAgICAgIG51bVBhbmVsID0gZmFsc2UsXHJcbiAgICAgICAgICAgIHNjcmVlbkNvbnN0LFxyXG4gICAgICAgICAgICBpbm5lciA9IGN1cnJTbGlkZXIuZmluZChcIi5ndC1zbGlkZXItaW5uZXJcIiksXHJcbiAgICAgICAgICAgIGlubmVyQ291bnQgPSBpbm5lci5sZW5ndGgsXHJcbiAgICAgICAgICAgIGJhc2VXaWR0aCxcclxuICAgICAgICAgICAgYmFzZUhlaWdodDtcclxuICAgICAgICBpZiAoY3VyclNsaWRlci5oYXNDbGFzcyhcImd0LXNsaWRlci1oYXMtYXJyb3dcIikpIHtcclxuICAgICAgICAgICAgYXJyb3cgPSB0cnVlO1xyXG4gICAgICAgICAgICBpZiAoY3VyclNsaWRlci5oYXNDbGFzcyhcImd0LXNsaWRlci1udW1cIikpIHtcclxuICAgICAgICAgICAgICAgIG51bVBhbmVsID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjdXJyU2xpZGVyLmFwcGVuZCgnPGRpdiBjbGFzcz1cImd0LXNsaWRlci1hcnJvdy1ob2xkZXJcIj48L2Rpdj4nKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGN1cnJTbGlkZXIuaGFzQ2xhc3MoXCJndC1zbGlkZXItaGFzLWRvdHNcIikpIHtcclxuICAgICAgICAgICAgZG90cyA9IHRydWU7XHJcbiAgICAgICAgICAgIGN1cnJTbGlkZXIuYXBwZW5kKCc8ZGl2IGNsYXNzPVwiZ3Qtc2xpZGVyLW5hdlwiPjwvZGl2PicpO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGZpbmRTY3JlZW5Db25zdCgpIHsvL3JlYWR5TmV3XHJcbiAgICAgICAgICAgIHNjcmVlbkNvbnN0ID0gMTtcclxuICAgICAgICAgICAgaWYgKGN1cnJTbGlkZXIuYXR0cihcImRhdGEtY291bnRcIikpIHtcclxuICAgICAgICAgICAgICAgIHNjcmVlbkNvbnN0ID0gcGFyc2VJbnQoY3VyclNsaWRlci5hdHRyKFwiZGF0YS1jb3VudFwiKSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoJCh0b2tlbjc2OCkuaXMoXCI6dmlzaWJsZVwiKSkgc2NyZWVuQ29uc3QgPSAzO1xyXG4gICAgICAgICAgICAgICAgaWYgKCQodG9rZW42NjcpLmlzKFwiOnZpc2libGVcIikpIHNjcmVlbkNvbnN0ID0gMjtcclxuICAgICAgICAgICAgICAgIGlmICgkKHRva2VuMzYwKS5pcyhcIjp2aXNpYmxlXCIpKSBzY3JlZW5Db25zdCA9IDE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNldEJhc2VXaWR0aCgpIHtcclxuICAgICAgICAgICAgaWYgKGFycm93KSBkZXN0cm95QXJyb3coKTtcclxuICAgICAgICAgICAgYmFzZVdpZHRoID0gY3VyclNsaWRlci5vdXRlcldpZHRoKCkgLyBzY3JlZW5Db25zdDtcclxuICAgICAgICAgICAgY3VyclNsaWRlclxyXG4gICAgICAgICAgICAgICAgLmZpbmQoXCIuZ3Qtc2xpZGVyLWNvbnRhaW5lclwiKVxyXG4gICAgICAgICAgICAgICAgLm91dGVyV2lkdGgoKGlubmVyQ291bnQgKyAxKSAqIGJhc2VXaWR0aCk7XHJcbiAgICAgICAgICAgIGlubmVyLmVhY2goZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgJCh0aGlzKS5vdXRlcldpZHRoKGJhc2VXaWR0aCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgaWYgKGlubmVyQ291bnQgPiBzY3JlZW5Db25zdCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGFycm93KSBjcmVhdGVBcnJvd3MoKTtcclxuICAgICAgICAgICAgICAgIGlmIChkb3RzKSBjcmVhdGVEb3RzKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc2V0QmFzZUhlaWd0aCgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2V0QmFzZUhlaWd0aCgpIHtcclxuICAgICAgICAgICAgYmFzZUhlaWdodCA9IGN1cnJTbGlkZXIub3V0ZXJIZWlnaHQoKTtcclxuICAgICAgICAgICAgY3VyclNsaWRlci5maW5kKCcuZ3QtaW1nLWhvbGRlcicpLm91dGVySGVpZ2h0KGJhc2VIZWlnaHQpO1xyXG4gICAgICAgICAgICAvLyBjdXJyU2xpZGVyLmZpbmQoJy5ndC1pbWctaG9sZGVyLWFicycpLm91dGVySGVpZ2h0KGJhc2VIZWlnaHQpOz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZmluZFNjcmVlbkNvbnN0KCk7XHJcbiAgICAgICAgc2V0QmFzZVdpZHRoKCk7XHJcbiAgICAgICAgY3JlYXRlVG91Y2goKTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY3JlYXRlQXJyb3dzKCkgey8vcmVhZHlOZXdcclxuICAgICAgICAgICAgdmFyIG51bUlubmVyID0gJyc7XHJcbiAgICAgICAgICAgIGlmIChudW1QYW5lbCkge1xyXG4gICAgICAgICAgICAgICAgbnVtSW5uZXIgPSAnPGRpdiBjbGFzcz1cImd0LXNsaWRlci1hcnJvdy1udW1cIj48aSBjbGFzcz1cImd0LXNsaWRlci1udW0tY3VyclwiPjE8L2k+IDxpPtC40Lc8L2k+IDxpIGNsYXNzPVwiZ3Qtc2xpZGVyLW51bS1tYXhcIj4xMDwvaT4gPC9kaXY+J1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBjdXJyU2xpZGVyXHJcbiAgICAgICAgICAgICAgICAuZmluZChcIi5ndC1zbGlkZXItYXJyb3ctaG9sZGVyXCIpXHJcbiAgICAgICAgICAgICAgICAuaHRtbChcclxuICAgICAgICAgICAgICAgICAgICAnPHNwYW4gY2xhc3MgPSBcImd0LXNsaWRlci1hcnJvdyBsZWZ0XCI+JyArXHJcbiAgICAgICAgICAgICAgICAgICAgJzxpIGNsYXNzPVwiZmEgZmEtYW5nbGUtbGVmdCBmYS0yeFwiPjwvaT4nICtcclxuICAgICAgICAgICAgICAgICAgICBcIjwvc3Bhbj5cIiArXHJcbiAgICAgICAgICAgICAgICAgICAgbnVtSW5uZXIgK1xyXG4gICAgICAgICAgICAgICAgICAgICc8c3BhbiBjbGFzcyA9IFwiZ3Qtc2xpZGVyLWFycm93IHJpZ2h0XCI+JyArXHJcbiAgICAgICAgICAgICAgICAgICAgJzxpIGNsYXNzPVwiZmEgZmEtYW5nbGUtcmlnaHQgZmEtMnhcIj48L2k+JyArXHJcbiAgICAgICAgICAgICAgICAgICAgXCI8L3NwYW4+XCJcclxuICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIGN1cnJTbGlkZXJcclxuICAgICAgICAgICAgICAgIC5maW5kKFwiLmxlZnRcIilcclxuICAgICAgICAgICAgICAgIC5vZmYoKVxyXG4gICAgICAgICAgICAgICAgLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG9uZU1vdmVGdW5jdGlvbihmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgY3VyclNsaWRlclxyXG4gICAgICAgICAgICAgICAgLmZpbmQoXCIucmlnaHRcIilcclxuICAgICAgICAgICAgICAgIC5vZmYoKVxyXG4gICAgICAgICAgICAgICAgLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG9uZU1vdmVGdW5jdGlvbih0cnVlKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBjaGVja1Bvc2l0aW9uKCk7XHJcbiAgICAgICAgICAgIGlmIChudW1QYW5lbCkgc2hvd051bSgpXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBkZXN0cm95QXJyb3coKSB7IC8vcmVhZHlOZXdcclxuICAgICAgICAgICAgY3VyclNsaWRlci5maW5kKFwiLmd0LXNsaWRlci1hcnJvdy1ob2xkZXJcIikuaHRtbChcIlwiKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGNyZWF0ZURvdHMoKSB7XHJcbiAgICAgICAgICAgIHZhciBuYXYgPSBjdXJyU2xpZGVyLmZpbmQoXCIuZ3Qtc2xpZGVyLW5hdlwiKSxcclxuICAgICAgICAgICAgICAgIHNwYW5zID0gXCJcIjtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBpbm5lckNvdW50OyBpKyspIHtcclxuICAgICAgICAgICAgICAgIHNwYW5zICs9IFwiPHNwYW4gZGF0YS1udW0gPSBcIiArIGkgKyBcIj48L3NwYW4+XCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgbmF2Lmh0bWwoc3BhbnMpO1xyXG5cclxuICAgICAgICAgICAgbmF2XHJcbiAgICAgICAgICAgICAgICAuZmluZChcInNwYW5cIilcclxuICAgICAgICAgICAgICAgIC5maXJzdCgpXHJcbiAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoXCJndC1hY3RpdmVcIik7XHJcbiAgICAgICAgICAgIGN1cnJTbGlkZXJcclxuICAgICAgICAgICAgICAgIC5maW5kKFwiLmd0LXNsaWRlci1uYXYgc3BhblwiKVxyXG4gICAgICAgICAgICAgICAgLm9mZigpXHJcbiAgICAgICAgICAgICAgICAub24oXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb25lTW92ZUZ1bmN0aW9uKHRydWUsICskKHRoaXMpLmF0dHIoXCJkYXRhLW51bVwiKSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGNyZWF0ZVRvdWNoKCkge1xyXG4gICAgICAgICAgICB2YXIgaW5pdGlhbFBvaW50ID0gMCxcclxuICAgICAgICAgICAgICAgIGZpbmFsUG9pbnQgPSAwO1xyXG4gICAgICAgICAgICBjdXJyU2xpZGVyLm9uKFwidG91Y2hzdGFydFwiLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgIHZhciBlID0gZXZlbnQub3JpZ2luYWxFdmVudDtcclxuICAgICAgICAgICAgICAgIGluaXRpYWxQb2ludCA9IE1hdGguYWJzKGUudG91Y2hlc1swXS5wYWdlWCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBjdXJyU2xpZGVyLm9uKFwidG91Y2hlbmRcIiwgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZSA9IGV2ZW50Lm9yaWdpbmFsRXZlbnQ7XHJcbiAgICAgICAgICAgICAgICBmaW5hbFBvaW50ID0gTWF0aC5hYnMoZS5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoTWF0aC5hYnMoaW5pdGlhbFBvaW50IC0gZmluYWxQb2ludCkgPiA1MCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpbml0aWFsUG9pbnQgPiBmaW5hbFBvaW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uZU1vdmVGdW5jdGlvbihmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb25lTW92ZUZ1bmN0aW9uKHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoY3VyclNsaWRlci5maW5kKFwiLmd0LXNsaWRlci1vcGVuLWNsb25lXCIpKSBjcmVhdGVDbG9uZUxpc3RlbmVycygpO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBjcmVhdGVDbG9uZUxpc3RlbmVycygpIHtcclxuICAgICAgICAgICAgdmFyIGNsb25lTGlzdGVuZXJzID0gY3VyclNsaWRlci5maW5kKFwiLmd0LXNsaWRlci1vcGVuLWNsb25lXCIpO1xyXG4gICAgICAgICAgICBjbG9uZUxpc3RlbmVycy5lYWNoKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICQodGhpcykub24oXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJ2Nsb25lTGlzdGVuZXJzJywgJCh0aGlzKS5wYXJlbnQoKS5pbmRleCgpKVxyXG4gICAgICAgICAgICAgICAgICAgIHNlbGYuY3JlYXRlQ2xvbmVTbGlkZXIoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJTbGlkZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5wYXJlbnQoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmluZGV4KClcclxuICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY2hlY2tQb3NpdGlvbigpIHtcclxuICAgICAgICAgICAgdmFyIGxlZnQgPSBjdXJyU2xpZGVyLmZpbmQoXCIubGVmdFwiKSxcclxuICAgICAgICAgICAgICAgIHJpZ2h0ID0gY3VyclNsaWRlci5maW5kKFwiLnJpZ2h0XCIpO1xyXG4gICAgICAgICAgICByaWdodC5yZW1vdmVDbGFzcyhcIm5vdC1hY3RpdmVcIik7XHJcbiAgICAgICAgICAgIGxlZnQucmVtb3ZlQ2xhc3MoXCJub3QtYWN0aXZlXCIpO1xyXG4gICAgICAgICAgICBpZiAoY3VyclBvc2l0aW9uID09IDApIGxlZnQuYWRkQ2xhc3MoXCJub3QtYWN0aXZlXCIpO1xyXG4gICAgICAgICAgICBpZiAoXHJcbiAgICAgICAgICAgICAgICBjdXJyUG9zaXRpb24gPT0gaW5uZXJDb3VudCAtIDEgfHxcclxuICAgICAgICAgICAgICAgIGN1cnJQb3NpdGlvbiA9PSBpbm5lckNvdW50IC0gc2NyZWVuQ29uc3RcclxuICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICAgICAgcmlnaHQuYWRkQ2xhc3MoXCJub3QtYWN0aXZlXCIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gb25lTW92ZUZ1bmN0aW9uKGJ1bCwgbnVtKSB7XHJcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGFycm93KTtcclxuICAgICAgICAgICAgaWYgKG51bSB8fCBudW0gPT09IDApIHtcclxuICAgICAgICAgICAgICAgIGN1cnJQb3NpdGlvbiA9IG51bTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChidWwpIHtcclxuICAgICAgICAgICAgICAgIGN1cnJQb3NpdGlvbiArPSAxO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY3VyclBvc2l0aW9uIC09IDE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGN1cnJQb3NpdGlvbiA+IGlubmVyQ291bnQgLSBzY3JlZW5Db25zdCkge1xyXG4gICAgICAgICAgICAgICAgY3VyclBvc2l0aW9uID0gaW5uZXJDb3VudCAtIHNjcmVlbkNvbnN0O1xyXG4gICAgICAgICAgICAgICAgc2VsZi5zbGlkZXJFbmRMZWZ0KGN1cnJTbGlkZXIpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChjdXJyUG9zaXRpb24gPCAwKSB7XHJcbiAgICAgICAgICAgICAgICBjdXJyUG9zaXRpb24gPSAwO1xyXG4gICAgICAgICAgICAgICAgc2VsZi5zbGlkZXJFbmRSaWdodChjdXJyU2xpZGVyKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzZWxmLnNsaWRlck1vdmUoY3VyclNsaWRlciwgYmFzZVdpZHRoLCBjdXJyUG9zaXRpb24pO1xyXG5cclxuXHJcbiAgICAgICAgICAgIGlmIChhcnJvdykgY2hlY2tQb3NpdGlvbigpO1xyXG4gICAgICAgICAgICBpZiAobnVtUGFuZWwpIHNob3dOdW0oKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNob3dOdW0oKSB7XHJcbiAgICAgICAgICAgIGN1cnJTbGlkZXIuZmluZCgnLmd0LXNsaWRlci1udW0tY3VycicpLnRleHQoY3VyclBvc2l0aW9uICsgMSk7XHJcbiAgICAgICAgICAgIGN1cnJTbGlkZXIuZmluZCgnLmd0LXNsaWRlci1udW0tbWF4JykudGV4dChpbm5lckNvdW50KTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAkKHdpbmRvdykucmVzaXplKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgZmluZFNjcmVlbkNvbnN0KCk7XHJcbiAgICAgICAgICAgIHNldEJhc2VXaWR0aCgpO1xyXG4gICAgICAgICAgICBpZiAoY3VyclBvc2l0aW9uID4gaW5uZXJDb3VudCAtIHNjcmVlbkNvbnN0KVxyXG4gICAgICAgICAgICAgICAgY3VyclBvc2l0aW9uID0gaW5uZXJDb3VudCAtIHNjcmVlbkNvbnN0O1xyXG4gICAgICAgICAgICBpZiAoaW5uZXJDb3VudCA8PSBzY3JlZW5Db25zdCkgY3VyclBvc2l0aW9uID0gMDtcclxuICAgICAgICAgICAgc2VsZi5zbGlkZXJNb3ZlKGN1cnJTbGlkZXIsIGJhc2VXaWR0aCwgY3VyclBvc2l0aW9uKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG59O1xyXG5cclxudGhpcy5jcmVhdGVDbG9uZVNsaWRlciA9IGZ1bmN0aW9uIChlbCwgbnVtKSB7XHJcbiAgICBpZiAoJChcImRpdlwiKS5pcyhcIiNndC1jbG9uZS1jbG9zZVwiKSkgcmV0dXJuO1xyXG4gICAgc2VsZi5maXhCb2R5KCk7XHJcbiAgICB2YXIgY3VyclBvc2l0aW9uID0gbnVtO1xyXG4gICAgJChcIiNndC1ib2R5LXdyYXBwZXJcIilcclxuICAgICAgICAuc2hvdygpXHJcbiAgICAgICAgLmFwcGVuZChcclxuICAgICAgICAgICAgXCJcIiArXHJcbiAgICAgICAgICAgICc8ZGl2IGlkID0gXCJndC1jbG9uZVwiIGNsYXNzPVwiZ3Qtc2xpZGVyLWNsb25lXCI+JyArXHJcbiAgICAgICAgICAgICc8ZGl2IGlkID0gXCJndC1jbG9uZS1jbG9zZVwiIGNsYXNzID0gXCJndC1zbGlkZXItY2xvbmUtY2xvc2VcIj4nICtcclxuICAgICAgICAgICAgXCI8L2Rpdj5cIiArXHJcbiAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwiY29udGFpbmVyXCI+JyArXHJcbiAgICAgICAgICAgICc8ZGl2IGlkID0gXCJndC1jbG9uZS1pbm5lclwiIGNsYXNzID0gXCJndC1zbGlkZXItY2xvbmUtaW5uZXJcIj4nICtcclxuICAgICAgICAgICAgJzxkaXYgaWQgPSBcImd0LWNsb25lLWNvbnRhaW5lclwiIGNsYXNzID0gXCJndC1zbGlkZXItY29udGFpbmVyIGd0LXNsaWRlci1jbG9uZS1jb250YWluZXJcIj48L2Rpdj4nICtcclxuICAgICAgICAgICAgXCI8L2Rpdj5cIiArXHJcbiAgICAgICAgICAgIFwiPC9kaXY+XCIgK1xyXG4gICAgICAgICAgICBcIjwvZGl2PlwiXHJcbiAgICAgICAgKTtcclxuICAgIHZhciBjdXJyU2xpZGVyID0gJChcIiNndC1jbG9uZS1pbm5lclwiKSxcclxuICAgICAgICBpbm5lcnMgPSBlbC5maW5kKFwiLmd0LXNsaWRlci1pbm5lclwiKS5jbG9uZSh0cnVlKSxcclxuICAgICAgICBpbm5lcnNMZW5naHQgPSBpbm5lcnMubGVuZ3RoO1xyXG4gICAgaW5uZXJzLmVhY2goZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICQodGhpcylcclxuICAgICAgICAgICAgLnJlbW92ZUNsYXNzKFwiZ3Qtc2xpZGVyLWlubmVyXCIpXHJcbiAgICAgICAgICAgIC5hZGRDbGFzcyhcImd0LWNsb25lLXNsaWRlci1pbm5lclwiKTtcclxuICAgICAgICAkKHRoaXMpXHJcbiAgICAgICAgICAgIC5maW5kKFwiLmd0LXNsaWRlci1pbm5lci1jb3ZlclwiKVxyXG4gICAgICAgICAgICAucmVtb3ZlKCk7XHJcbiAgICAgICAgJChcIiNndC1jbG9uZS1jb250YWluZXJcIikuYXBwZW5kKCQodGhpcykpO1xyXG4gICAgfSk7XHJcbiAgICBpZiAoaW5uZXJzTGVuZ2h0ID4gMSkge1xyXG4gICAgICAgICQoXCIjZ3QtY2xvbmUgLmNvbnRhaW5lclwiKS5hcHBlbmQoXHJcbiAgICAgICAgICAgICc8c3BhbiBjbGFzcyA9IFwiZ3Qtc2xpZGVyLWFycm93IGxlZnRcIiBpZCA9IFwiZ3QtY2xvbmUtYXJyb3ctbGVmdFwiPicgK1xyXG4gICAgICAgICAgICAnPGkgY2xhc3M9XCJmYSBmYS1hbmdsZS1sZWZ0IGZhLTJ4XCI+PC9pPicgK1xyXG4gICAgICAgICAgICBcIjwvc3Bhbj5cIiArXHJcbiAgICAgICAgICAgICc8c3BhbiBjbGFzcyA9IFwiZ3Qtc2xpZGVyLWFycm93IHJpZ2h0XCIgaWQgPSBcImd0LWNsb25lLWFycm93LXJpZ2h0XCI+JyArXHJcbiAgICAgICAgICAgICc8aSBjbGFzcz1cImZhIGZhLWFuZ2xlLXJpZ2h0IGZhLTJ4XCI+PC9pPicgK1xyXG4gICAgICAgICAgICBcIjwvc3Bhbj5cIlxyXG4gICAgICAgICk7XHJcbiAgICAgICAgJChcIiNndC1jbG9uZS1hcnJvdy1sZWZ0XCIpLm9uKFwiY2xpY2tcIiwgbW92ZUNsb25lU2xpZGVyTGVmdCk7XHJcbiAgICAgICAgJChcIiNndC1jbG9uZS1hcnJvdy1yaWdodFwiKS5vbihcImNsaWNrXCIsIG1vdmVDbG9uZVNsaWRlclJpZ2h0KTtcclxuICAgIH1cclxuXHJcbiAgICB2YXIgY29udGFpbmVyID0gY3VyclNsaWRlci5maW5kKFwiI2d0LWNsb25lLWNvbnRhaW5lclwiKSxcclxuICAgICAgICAvLyBpbm5lcnMgPSBjb250YWluZXIuZmluZCgnLmd0LWNsb25lLXNsaWRlci1pbm5lcicpLFxyXG4gICAgICAgIGlubmVyTGVuZ3RoID0gaW5uZXJzLmxlbmd0aCxcclxuICAgICAgICBiYXNlV2lkdGggPSBjdXJyU2xpZGVyLm91dGVyV2lkdGgoKTtcclxuXHJcbiAgICBpbm5lcnMuZWFjaChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgJCh0aGlzKS5vdXRlcldpZHRoKGJhc2VXaWR0aCk7XHJcbiAgICB9KTtcclxuICAgIGNvbnRhaW5lci5vdXRlcldpZHRoKGJhc2VXaWR0aCAqIChpbm5lckxlbmd0aCArIDEpKTtcclxuICAgIGNvbnRhaW5lci5jc3MoXCJtYXJnaW4tbGVmdFwiLCBiYXNlV2lkdGggKiAtMSAqIGN1cnJQb3NpdGlvbiArIFwicHhcIik7XHJcbiAgICBzZXRUaW1lb3V0KGFkZEFuaW1hdGlvbik7XHJcblxyXG4gICAgZnVuY3Rpb24gYWRkQW5pbWF0aW9uKCkge1xyXG4gICAgICAgIGNvbnRhaW5lci5hZGRDbGFzcyhcImd0LWFuaW1hdGVkXCIpO1xyXG4gICAgfVxyXG5cclxuICAgIGNoZWNrUG9zaXRpb24oKTtcclxuICAgIHZhciBpbml0aWFsUG9pbnQgPSAwLFxyXG4gICAgICAgIGZpbmFsUG9pbnQgPSAwO1xyXG4gICAgY3VyclNsaWRlci5vbihcInRvdWNoc3RhcnRcIiwgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgdmFyIGUgPSBldmVudC5vcmlnaW5hbEV2ZW50O1xyXG4gICAgICAgIGluaXRpYWxQb2ludCA9IE1hdGguYWJzKGUudG91Y2hlc1swXS5wYWdlWCk7XHJcbiAgICB9KTtcclxuICAgIGN1cnJTbGlkZXIub24oXCJ0b3VjaGVuZFwiLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICB2YXIgZSA9IGV2ZW50Lm9yaWdpbmFsRXZlbnQ7XHJcbiAgICAgICAgZmluYWxQb2ludCA9IE1hdGguYWJzKGUuY2hhbmdlZFRvdWNoZXNbMF0ucGFnZVgpO1xyXG4gICAgICAgIGlmIChNYXRoLmFicyhpbml0aWFsUG9pbnQgLSBmaW5hbFBvaW50KSA+IDUwKSB7XHJcbiAgICAgICAgICAgIGlmIChpbml0aWFsUG9pbnQgPiBmaW5hbFBvaW50KSB7XHJcbiAgICAgICAgICAgICAgICBtb3ZlQ2xvbmVTbGlkZXJMZWZ0KCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBtb3ZlQ2xvbmVTbGlkZXJSaWdodCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgJChcIiNndC1jbG9uZS1jbG9zZVwiKS5vbihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBzZWxmLmRlc3Ryb3lDbG9uZVNsaWRlcigpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZnVuY3Rpb24gbW92ZUNsb25lU2xpZGVyUmlnaHQoKSB7XHJcbiAgICAgICAgY3VyclBvc2l0aW9uICs9IDE7XHJcbiAgICAgICAgaWYgKGN1cnJQb3NpdGlvbiA+IGlubmVyTGVuZ3RoIC0gMSkge1xyXG4gICAgICAgICAgICBjdXJyUG9zaXRpb24gPSBpbm5lckxlbmd0aCAtIDE7XHJcbiAgICAgICAgICAgIHNlbGYuc2xpZGVyRW5kUmlnaHQoY3VyclNsaWRlcik7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgc2VsZi5zbGlkZXJNb3ZlKGN1cnJTbGlkZXIsIGJhc2VXaWR0aCwgY3VyclBvc2l0aW9uKTtcclxuICAgICAgICBjaGVja1Bvc2l0aW9uKCk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gbW92ZUNsb25lU2xpZGVyTGVmdCgpIHtcclxuICAgICAgICBjdXJyUG9zaXRpb24gLT0gMTtcclxuICAgICAgICBpZiAoY3VyclBvc2l0aW9uIDwgMCkge1xyXG4gICAgICAgICAgICBjdXJyUG9zaXRpb24gPSAwO1xyXG4gICAgICAgICAgICBzZWxmLnNsaWRlckVuZExlZnQoY3VyclNsaWRlcik7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgc2VsZi5zbGlkZXJNb3ZlKGN1cnJTbGlkZXIsIGJhc2VXaWR0aCwgY3VyclBvc2l0aW9uKTtcclxuICAgICAgICBjaGVja1Bvc2l0aW9uKCk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gY2hlY2tQb3NpdGlvbigpIHtcclxuICAgICAgICBpZiAoISQoXCIjZ3QtY2xvbmUtYXJyb3ctbGVmdFwiKSkgcmV0dXJuO1xyXG4gICAgICAgIHZhciBsZWZ0ID0gJChcIiNndC1jbG9uZS1hcnJvdy1sZWZ0XCIpLFxyXG4gICAgICAgICAgICByaWdodCA9ICQoXCIjZ3QtY2xvbmUtYXJyb3ctcmlnaHRcIik7XHJcbiAgICAgICAgcmlnaHQucmVtb3ZlQ2xhc3MoXCJub3QtYWN0aXZlXCIpO1xyXG4gICAgICAgIGxlZnQucmVtb3ZlQ2xhc3MoXCJub3QtYWN0aXZlXCIpO1xyXG4gICAgICAgIGlmIChjdXJyUG9zaXRpb24gPT0gMCkgbGVmdC5hZGRDbGFzcyhcIm5vdC1hY3RpdmVcIik7XHJcbiAgICAgICAgaWYgKGN1cnJQb3NpdGlvbiA9PSBpbm5lckxlbmd0aCAtIDEpIHJpZ2h0LmFkZENsYXNzKFwibm90LWFjdGl2ZVwiKTtcclxuICAgIH1cclxufTtcclxuXHJcbnRoaXMuZGVzdHJveUNsb25lU2xpZGVyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgJChcIiNndC1jbG9uZS1hcnJvdy1yaWdodFwiKS5vZmYoKTtcclxuICAgICQoXCIjZ3QtY2xvbmUtYXJyb3ctbGVmdFwiKS5vZmYoKTtcclxuICAgICQoXCIjZ3QtY2xvbmUtY2xvc2VcIikub2ZmKCk7XHJcbiAgICAkKFwiI2d0LWNsb25lLWlubmVyXCIpLm9mZigpO1xyXG4gICAgJChcIiNndC1jbG9uZVwiKS5yZW1vdmUoKTtcclxuICAgICQoXCIjZ3QtYm9keS13cmFwcGVyXCIpLmhpZGUoKTtcclxuICAgIHNlbGYudW5maXhCb2R5KCk7XHJcbn07XHJcblxyXG5cclxudGhpcy5zbGlkZXJFbmRMZWZ0ID0gZnVuY3Rpb24gKGVsKSB7XHJcbiAgICBjb25zb2xlLmxvZyhcImxlZnRfZW5kXCIpO1xyXG59O1xyXG5cclxudGhpcy5zbGlkZXJFbmRSaWdodCA9IGZ1bmN0aW9uIChlbCkge1xyXG4gICAgY29uc29sZS5sb2coXCJyaWdodF9lbmRcIik7XHJcbn07XHJcblxyXG50aGlzLnNsaWRlck1vdmUgPSBmdW5jdGlvbiAoZWwsIHdpZHRoLCBwb3NpdGlvbikge1xyXG4gICAgaWYgKGVsLmZpbmQoXCIuZ3Qtc2xpZGVyLW5hdlwiKSkge1xyXG4gICAgICAgIHZhciBkb3RzID0gZWwuZmluZChcIi5ndC1zbGlkZXItbmF2IHNwYW5cIik7XHJcbiAgICAgICAgZG90cy5yZW1vdmVDbGFzcyhcImd0LWFjdGl2ZVwiKTtcclxuICAgICAgICAkKGRvdHNbcG9zaXRpb25dKS5hZGRDbGFzcyhcImd0LWFjdGl2ZVwiKTtcclxuICAgIH1cclxuICAgIGVsXHJcbiAgICAgICAgLmZpbmQoXCIuZ3Qtc2xpZGVyLWNvbnRhaW5lclwiKVxyXG4gICAgICAgIC5jc3MoXCJtYXJnaW4tbGVmdFwiLCB3aWR0aCAqIC0xICogcG9zaXRpb24gKyBcInB4XCIpO1xyXG59O1xyXG5cclxuXHJcblxyXG5cclxudGhpcy5udW1iZXJDb2xsZWN0aW9uQXJ0aWNsZSA9IGZ1bmN0aW9uIChlbCkge1xyXG4gICAgZWwuZmluZChcIi5ndC1jb2xsZWN0aW9uLWxpbmstd3JhcHBlclwiKS5lYWNoKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAkKHRoaXMpLmZpbmQoJy5ndC1jb2xsZWN0aW9uLWxpbmstc2xpZGVyLXdyYXBwZXInKS5hZnRlcignPGRpdiBjbGFzcyA9IFwiZ3QtY29sbGVjdGlvbi1saW5rLW51bWJlclwiPjxzcGFuPicgKyAoJCh0aGlzKS5pbmRleCgpICsgMSkgKyAnPC9zcGFuPjwvZGl2PicpXHJcbiAgICAgICAgLy8gY29uc29sZS5sb2coJCh0aGlzKSk7XHJcbiAgICB9KTtcclxufTtcclxuXHJcblxyXG5cclxuaWYgKCQoXCJkaXZcIikuaXMoXCIuZ3QtY29sbGVjdGlvbi13cmFwcGVyLW51bVwiKSkge1xyXG4gICAgJChcIi5ndC1jb2xsZWN0aW9uLXdyYXBwZXItbnVtXCIpLmVhY2goZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHNlbGYubnVtYmVyQ29sbGVjdGlvbkFydGljbGUoJCh0aGlzKSk7XHJcbiAgICB9KTtcclxufVxyXG5cclxuaWYgKCQoXCJkaXZcIikuaXMoXCIuZ3Qtc2xpZGVyXCIpKSB7XHJcbiAgICBzZWxmLmNyZWF0ZVNsaWRlcnMoKTtcclxufSJdfQ==
